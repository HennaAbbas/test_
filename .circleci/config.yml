version: '2.1'
#test

orbs:
  win: circleci/windows@5.0 # The Windows orb gives you everything you need to start using the Windows executor. 
  ruby: circleci/ruby@2.0.0
  node: circleci/node@5
  browser-tools: circleci/browser-tools@1.4.1  

jobs:
  build: # name of your job
    docker:
      - image: cimg/go:1.20.0
    steps:
      - add_ssh_keys: 
          fingerprints:
            - 39:e6:81:b6:55:c4:2f:9e:c6:3c:d7:09:b6:ca:ed:aa
      - checkout      
      - run : git config --global user.email "henna@circleci.com"
      - run : git config --global user.name "HennaAbbas"  
      - run : git tag -a v1.5 -m "my version 1.5"
      - run : git tag -l --points-at $CIRCLE_SHA1
      - run : git push $CIRCLE_REPOSITORY_URL "v1.5"
  test: # name of your job
    docker:
      - image: cimg/go:1.20.0
    steps:
      - checkout
      - run: GITHUB_SHA=$(git rev-parse --short HEAD) 
      - run: echo $GITHUB_SHA
      - run: git tag -l --points-at $CIRCLE_SHA1 
    
    
  run_unit_tests-1:
    resource_class: macos.m1.large.gen1
    macos:
      xcode: 14.0.1
    steps:
      - run: brew --version
      - run: brew update  
      - run:
          command: brew --version  
     
        
  run_unit_tests-2:
    macos:
      xcode: 14.2.0
    resource_class: macos.x86.medium.gen2
    steps:
    - node/install:
        node-version: "16.13"     
        

workflows:
  main:
    jobs:
      - build
      - run_unit_tests-1
      - run_unit_tests-2
      - test:
          requires: 
            - build

