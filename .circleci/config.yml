version: 2.1
# commands: # a reusable command with parameters
#   greeting:
#     parameters:
#       to:
#         default: "world"
#         type: string
#     steps:
#       - run: echo "Hello <<parameters.to>>"
jobs:
  say-date:
    docker:
      - image: cimg/base:stable
    parameters:
      date:
        type: string
        default: none      
    steps:
      - checkout
      - run:
        name: set var
          command: echo 'export DATETIME="FOO"' >> "$BASH_ENV"
#           echo 'export MY_ENV_VAR="FOO"' >> "$BASH_ENV"
      - run: echo "$DATETIME"
      - run: mkdir -p workspace
      - run: echo "export DATETIME=datetime.`date +%Y%m%d.%H%M%S`" >>workspace/new-env-vars
      - run: echo "export BOB=$BAZ" >> workspace/new-env-vars
      - run: cat workspace/new-env-vars 
      - run: cat workspace/new-env-vars >> $BASH_ENV
      - run: echo ${DATETIME:-NULL}
      - run: 
          name: make test artifacts
          command: |
            mkdir /tmp/artifacts;
            echo "my artifact files in a dir" > /tmp/artifacts/encap-staging-no-color_${DATETIME:-NULL}.txt 
      - store_artifacts:
          path: /tmp/artifacts
      - persist_to_workspace:
          root: workspace
          paths:
            - new-env-vars
          
workflows:
  my-workflow:
    jobs:
      - say-date
