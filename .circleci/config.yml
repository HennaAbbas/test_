version: 2.1
  
jobs:
  build:
    parameters:
      branch:
        type: string
        default: $CIRCLE_BRANCH 
    docker:
      - image: cimg/node@sha256:180f8e47d941e4b2b6eb5244b7f90d67aa63d9b62443aea02052b4b26107a896
    
    steps:
      - setup_remote_docker
      - run: cat /proc/sys/fs/inotify/max_user_watches
      - run: |
             ssh remote-docker \ sudo sysctl -w fs.inotify.max_user_watches=60668
      - run: sudo sysctl fs.inotify.max_user_watches=60668
      - run: cat /proc/sys/fs/inotify/max_user_watches      

      


  test:
    docker:
      - image: cimg/node@sha256:180f8e47d941e4b2b6eb5244b7f90d67aa63d9b62443aea02052b4b26107a896
    
    steps:
      - setup_remote_docker: 
          version: previous
      - run: cat /proc/sys/fs/inotify/max_user_watches 
  ios-build-and-test:
    macos:
      xcode: 15.3.0
    resource_class: macos.m1.medium.gen1
    steps:
    - run:
        name: Upgarade xz
        command: brew update && brew upgrade xz      



workflows:
  say-hello-workflow:
    jobs:
      - test:
          filters:
            tags:
              only: /^pre-.*/   
      - build
      - ios-build-and-test


