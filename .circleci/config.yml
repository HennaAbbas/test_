
   
version: 2.1

jobs:
  build:
    docker:
      - image: cimg/ruby:2.7.4-browsers

    steps:
      - run : sudo apt-get install xvfb libgtk2.0-0 libnotify-dev libgconf-2-4 libnss3 libxss1 libasound2           

      - run : echo "hello world! this is the build job" 
      - run:
          name: add environment variable
          command: |
            curl -u "${CIRCLECI_TOKEN}": -X POST --header "Content-Type: application/json" -d '{"parameters": {"branch_name": "${CIRCLE_BRANCH}"}}' https://circleci.com/api/v2/project/github/HennaAbbas/test_/pipeline 
          
          #


  test:
    docker:
      - image: circleci/python:3.8.12-node-browsers
      
    steps:
      - run : echo "hello world - test job"      
      
  will_fail:
    docker:
      - image: circleci/python:3.8.12-node-browsers
      
    steps:
      - run : wqr       
      

    
            
# # #
workflows:
    build_and_push:
      jobs:
        - build   
        - test 
        - hold: 
            type: approval 
            requires: 
              - test
        - will_fail: 
            requires: 
              - hold 
            filters:   
              tags:
                only: /^recs-v.*/              
        - build: 
            requires: 
              - hold 
            context: 
              my-context
            filters:   
              tags:
                only: /^recs-v.*/               
        - build: 
            requires: 
              - will_fail
            context: 
              my-context  
            filters:   
              tags:
                only: /^recs-v.*/              
#test
