version: 2.1
commands:
  rollback_steps:
    steps:
      - run: echo "run rollback steps"
      
jobs:
  build:
    docker:
      - image: cimg/base:2020.01
    steps:

      - run: echo "hello world"
      - rollback_steps:
          when: on_fail
               
  test:
    docker:
      - image: cimg/base:2020.01
    steps:
      - run: echo "test job"
      - run: wqr
      - rollback_steps:
          when: on_fail    

  deploy:
    docker:
      - image: cimg/base:2020.01
    steps:
      - run: echo "deploy"
      
            
            #test
workflows:
  build-test:
    jobs:
      - build
      - test
      - deploy
