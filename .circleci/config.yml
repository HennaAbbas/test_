version: 2.1

executors:
  nodejs:
    macos:
      xcode: 12.5.1

parameters:
  my_branch_name:
    type: string
    default: "develop"
  my_param:
    type: string
    default: "test"  
  last_commit: 
    type: string
    default: "0816ff9b329e63746f394f6061743cdc913ae7c2"
    


jobs:
  update:
    docker:
    - image: cimg/node:17.1.0
    steps:
    - checkout
    - run:
        command: |
          sudo npm install -g cloc
    - run:
        command: |
          sudo npm install -g cloc
          if [ "$IS_DEBUG" = "1" ]; then
              echo STARTING......
              echo "$TIMEOUT"
              echo "$PATH"
              echo "$date"
              current_time=$(date "+%Y.%m.%d-%H.%M.%S")
              echo "Current Time : $current_time"
          fi
          file_name=~/project/"$OUTPUT_FILE_PATH"/cloc/"$OUTPUT_FILE_NAME""$FILE_TYPE"
          if [ "$IS_DEBUG" = "1" ]; then
              echo "$file_name"
          fi
          echo "export QUIET=" >> $BASH_ENV
          if [ "$IS_QUIET" = "1" ]; then
              echo "$IS_QUIET"
              echo "export QUIET=--quiet" >> $BASH_ENV
          fi
          cloc "$PATH" --report-file=${file_name} "$QUIET" --timeout "$TIMEOUT"
          echo "export FILE_PATH=${file_name}" >> $BASH_ENV
          if [ "$IS_DEBUG" = "1" ]; then
              echo ENDING......
          fi
        environment:
          DIFF: ''
          FILE_TYPE: .json
          IS_DEBUG: true
          IS_QUIET: true
          OUTPUT_FILE_NAME: my_file
          OUTPUT_FILE_PATH: build
          PATH: ~/project
          TIMEOUT: 10
        name: Execute Cloc          

#       - run:
#           name: pipeline parameters branch name
#           command: echo << pipeline.parameters.my_branch_name >>
#       - run:
#           name: my param
#           command: echo << pipeline.parameters.my_param >>   
#       - run : echo $LAST_SUCCESSFUL_COMMIT     




workflows:
  update-component:
    jobs:
      - update:
          name: Update
         
            

# version: '2.1'
# setup: true
# orbs:
#   continuation: circleci/continuation@0.2.0
# workflows:
#   use-my-orb:
#     jobs:
#       - continuation/continue:
#           configuration_path: ./config.yml
