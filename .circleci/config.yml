version: 2.1
orbs:
  hello-world: viar/hello-world@0.0.2
  browser-tools: circleci/browser-tools@1.4.4
parameters:
  test-suite:
    type: string
    default: ""

jobs:
  hello-job:
    docker:
      - image: cimg/node:17.2.0 # the primary container, where your job's commands are run
    steps:
      - checkout # check out the code in the project directory
  deploy_testflight:
    macos:
      xcode: 14.3.1
    resource_class: macos.x86.medium.gen2  
    steps:
      - browser-tools/install-chrome:
          # TODO remove following line when fixed https://github.com/CircleCI-Public/browser-tools-orb/issues/90
          chrome-version: 116.0.5845.96
      - browser-tools/install-chromedriver  
  failing_job:
    docker:
      - image: cimg/node:17.2.0 # the primary container, where your job's commands are run
    steps:    
      - run:
          name: Commit new image to repo
          command: |
            export COMMIT_MESSAGE=$(git log -1 --pretty=oneline)
            cd ./edgebook-manifests
            git config --local user.email "scorebet-bot@thescore.com"
            git config --local user.name "scorebet-bot"
            git config --global gpg.format ssh
            git config --global gpg.ssh.defaultKeyCommand "ssh-add -L"
            git config --global commit.gpgsign true
            git commit -am "CircleCI: Helm chart for edgebook ${CIRCLE_BRANCH} branch updated with \"${COMMIT_MESSAGE}\""
            git push origin $TARGET_BRANCH      

workflows:
  other-failing-workflow:  
    jobs:
      - failing_job  
      
  my-workflow:
    when: 
      equal: [ test, << pipeline.parameters.test-suite >> ]
    
  
    jobs:
      - hello-job
 
  my-test-workflow:
    # when: 
    #   equal: [ test-1, << pipeline.parameters.test-suite >> ]
    
  
    jobs:
 
      - hello-world/greet: 
          to: "henna"           
  my-failing-workflow:
    jobs:
      - hello-world/greet: 
          to: "henna" 
   
         


