version: 2.1
orbs:
  aws-ecr: circleci/aws-ecr@7.3.0
  aws-eks: circleci/aws-eks@2.1.0
  kubernetes: circleci/kubernetes@1.0.2
jobs:
  build_and_push:
    executor: aws-eks/python
    steps:
      - setup_remote_docker:
          docker_layer_caching: true
      - aws-ecr/build-and-push-image:
          account-url: AWS_ACCOUNT_URL
          repo: "service/profiles"
          region: AWS_DEFAULT_REGION
          tag: ${CIRCLE_SHA1}
          dockerfile: Dockerfile

workflows:
  build_and_test_server:
    jobs:
      - build_and_push:
          name: build-and-push

     
