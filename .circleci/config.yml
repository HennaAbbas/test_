version: 2.1
commands: 
  check-branch-for-postgres:
    parameters:
      workflow_name:
        type: string
    steps:
      - run:
          name: Check branch for postgres suffix
          command: |
            if [ "<< parameters.workflow_name >>" = "hopper-workflow" ] && [[ "${CIRCLE_BRANCH}" =~ .*(_|-)qe(_|-)postgres$ ]] \
              || [ "<< parameters.workflow_name >>" = "e2e-tests-workflow" ] \
              || [ "<< parameters.workflow_name >>" = "optional_qe_jobs" ]; then
              # continue execution
              exit 0
            else
              # exit job with success
              # https://circleci.com/docs/2.0/configuration-reference/#ending-a-job-from-within-a-step
              circleci-agent step halt
            fi
jobs:
   build:
    parameters:   
      workflow_name:
        type: string       
    machine:
      image: ubuntu-2004-cuda-11.2:202103-01
    steps:
    - checkout    
    - check-branch-for-postgres:
         workflow_name: << parameters.workflow_name >>    


workflows:
  my_workflow:
    jobs:
      - build: 
          name: my build  
          workflow_name: "something else"    


  other_workflow:
    jobs: 
      - build: 
          name: other build 
          workflow_name: "something"
