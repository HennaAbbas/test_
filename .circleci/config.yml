version: 2.1

orbs:
  heroku: circleci/heroku@1.2.6
  android: circleci/android@1.0.3  
  node: circleci/node@4.7.0



jobs:
  heroku_test:
    machine: true
    steps:
      - checkout


          
  ios-staging:
    macos:
      xcode: 12.4.0
    shell: /bin/bash --login -o pipefail
    steps:
      - checkout
#       - run : echo insecure >> $HOME/.curlrc
#       - node/install:
#           node-version: '12.18.3'
#           install-yarn: true
#           yarn-version: '1.22.10'      
 
  unit-test:
    executor:
      name: android/android
      sdk-version: '30'
    resource_class: large

    steps:
      - checkout 
          





  build:
    docker:
      - image: cimg/node:12.20.2
#         auth:
#           username: $DOCKERHUB_USERNAME
#           password: $DOCKERHUB_PASSWORD       
    steps:
      - checkout
      


     
      
        

  test:
    docker:
      - image: circleci/android:api-30
      
    steps:
      - run : echo "hello world"  
      - run : 'export RUN_TEST=true' >> $BASH_ENV
      - run : echo $RUN_TEST
      - when:
          condition:           - 
            equal: [ true, $RUN_TEST >> ]
          steps:
            - run : echo "conditional steps are running "  
    
            
# # #
workflows:
    build_and_push:
      jobs:
        - build
        - heroku_test
        - unit-test
        - ios-staging
    test: 
      jobs:
        - build
        - test    


#     my-workflow:
#       when:
#         and:
#           - not:
#               matches:
#                 pattern: "^master$"
#                 value: << pipeline.git.branch >>        
#       jobs:
  
            





